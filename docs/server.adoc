= Running Server

After setup our <<config.adoc#,config>>, create the <<connectors.adoc#,connectors>> and implement the <<endpoints.adoc#,interactions endpoints>> is time to put all together and can't be more easy, as commented before you can use as reference the https://uk-gitlab.almuk.santanderuk.corp/verified-id/op-server[Santander-uk project] but let us see an example in code here:

.OpServer.js
----
const { IAmId } = require('@santander/iamid-provider') <1>
const InteractionRouter = require('./interaction-router')
const MyConnector = require('./connector')

<2>
const secrets = require('../config/secrets')
const environment = require('../config/environment')

const connector = new MyConnector(environment) <3>
const app = new IAmId(environment, secrets) <4>
app.use(new InteractionRouter(app, connector).routes()) <5>

<6>
const port = process.env.PORT || 8080
app.init().then((app) => {
  app.listen(port, () => {
    logger.info(`Op Server listening on port ${port}`)
  }).on('close', () => { app.close() })
}).catch((err) => {
  logger.error(err)
})

----
<1> Import `IAmId` from `iamid-provider`
<2> Obtain the config from a static json file, in case of put this in a docker the files can be in a volume so can be overwritten by environment.
<3> Instantiate the connectors.
<4> Create the instance of the `IAmId` app, passing the environment and secret configuration.
<5> Add into the `IAmId` app the extension of the `IAmIdRouter` with our custom endpoints.
<6> Initialize the app and start listening on port 8080.

That's All!!

